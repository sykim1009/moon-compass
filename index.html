<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>달 추적 앱</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #gps, #gyro, #moon { margin: 20px; }
        button { padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>달 추적 앱</h1>
    <div id="gps">GPS: 대기 중...</div>
    <div id="gyro">자이로: 대기 중...</div>
    <div id="moon">달 정보: 대기 중...</div>
    <button onclick="startTracking()">추적 시작</button>

    <script>
        // GPS 업데이트
        function updateGPS() {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    document.getElementById('gps').innerText = 
                        `GPS: 위도 ${latitude.toFixed(4)}, 경도 ${longitude.toFixed(4)}`;
                },
                (error) => {
                    document.getElementById('gps').innerText = `GPS 오류: ${error.message}`;
                }
            );
        }

        // 자이로 업데이트
        function updateGyro(event) {
            const { alpha, beta, gamma } = event;
            document.getElementById('gyro').innerText = 
                `자이로: Alpha ${alpha.toFixed(1)}, Beta ${beta.toFixed(1)}, Gamma ${gamma.toFixed(1)}`;
        }

        // 자이로 권한 요청
        function requestOrientationPermission() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', updateGyro);
                        } else {
                            alert('자이로 권한이 필요합니다.');
                        }
                    })
                    .catch(console.error);
            } else {
                window.addEventListener('deviceorientation', updateGyro);
            }
        }

        // 달 위치 추적
        function startTracking() {
            navigator.geolocation.getCurrentPosition((position) => {
                const { latitude, longitude } = position.coords;
                const now = new Date();
                const moonPos = SunCalc.getMoonPosition(now, latitude, longitude);
                const { azimuth, altitude } = moonPos;

                const azimuthDeg = (azimuth * 180 / Math.PI).toFixed(2);
                const altitudeDeg = (altitude * 180 / Math.PI).toFixed(2);

                document.getElementById('moon').innerText = 
                    `달 위치: 방위각 ${azimuthDeg}°, 고도 ${altitudeDeg}°`;

                window.addEventListener('deviceorientation', (event) => {
                    const { alpha } = event;
                    const delta = (azimuthDeg - alpha).toFixed(2);
                    let guidance = '';
                    if (Math.abs(delta) < 10) {
                        guidance = '정확한 방향입니다!';
                    } else if (delta > 0) {
                        guidance = `오른쪽으로 ${Math.abs(delta)}° 회전하세요.`;
                    } else {
                        guidance = `왼쪽으로 ${Math.abs(delta)}° 회전하세요.`;
                    }
                    document.getElementById('moon').innerText = 
                        `달 위치: 방위각 ${azimuthDeg}°, 고도 ${altitudeDeg}°\n안내: ${guidance}`;
                });
            });
        }

        // 초기화
        setInterval(updateGPS, 1000);
        requestOrientationPermission();
    </script>
</body>
</html>